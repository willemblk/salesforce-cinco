// Fix SR Tapijt Pricing - Update to correct values
// SR-PRIM-TAPIJT-PLAT: ‚Ç¨5.00 ‚Üí ‚Ç¨18.50/m¬≤
// SR-PRIM-TAPIJT-TRAP: ‚Ç¨7.50 ‚Üí ‚Ç¨8.50/trede (slightly increase)

System.debug('üîß ===== FIXING SR TAPIJT PRICING =====');

// Find the products
List<Product2> products = [
    SELECT Id, ProductCode, Name
    FROM Product2
    WHERE ProductCode IN ('SR-PRIM-TAPIJT-PLAT', 'SR-PRIM-TAPIJT-TRAP')
];

if (products.isEmpty()) {
    System.debug('‚ùå ERROR: Products not found!');
} else {
    Map<String, Id> productMap = new Map<String, Id>();
    for (Product2 p : products) {
        productMap.put(p.ProductCode, p.Id);
        System.debug('‚úÖ Found product: ' + p.ProductCode + ' (' + p.Name + ')');
    }
    
    // Find existing price records
    List<Prijsmanagement__c> priceRecords = [
        SELECT Id, Product__c, Product__r.ProductCode, Eenheidsprijs__c
        FROM Prijsmanagement__c
        WHERE Product__c IN :productMap.values()
          AND Actief__c = true
    ];
    
    if (priceRecords.isEmpty()) {
        System.debug('‚ö†Ô∏è No active price records found - creating new ones');
        
        // Create new price records
        List<Prijsmanagement__c> newPrices = new List<Prijsmanagement__c>();
        
        if (productMap.containsKey('SR-PRIM-TAPIJT-PLAT')) {
            newPrices.add(new Prijsmanagement__c(
                Product__c = productMap.get('SR-PRIM-TAPIJT-PLAT'),
                Eenheidsprijs__c = 18.50,
                Price_Type__c = 'Normaal',
                Actief__c = true,
                Geldig_vanaf__c = Date.today()
            ));
        }
        
        if (productMap.containsKey('SR-PRIM-TAPIJT-TRAP')) {
            newPrices.add(new Prijsmanagement__c(
                Product__c = productMap.get('SR-PRIM-TAPIJT-TRAP'),
                Eenheidsprijs__c = 8.50,
                Price_Type__c = 'Normaal',
                Actief__c = true,
                Geldig_vanaf__c = Date.today()
            ));
        }
        
        if (!newPrices.isEmpty()) {
            insert newPrices;
            System.debug('‚úÖ Created ' + newPrices.size() + ' new price records');
        }
    } else {
        System.debug('üìù Updating existing price records');
        
        List<Prijsmanagement__c> toUpdate = new List<Prijsmanagement__c>();
        
        for (Prijsmanagement__c pr : priceRecords) {
            Decimal oldPrice = pr.Eenheidsprijs__c;
            Decimal newPrice = oldPrice;
            
            if (pr.Product__r.ProductCode == 'SR-PRIM-TAPIJT-PLAT') {
                newPrice = 18.50;
                System.debug('  - SR-PRIM-TAPIJT-PLAT: ‚Ç¨' + oldPrice + ' ‚Üí ‚Ç¨' + newPrice);
            } else if (pr.Product__r.ProductCode == 'SR-PRIM-TAPIJT-TRAP') {
                newPrice = 8.50;
                System.debug('  - SR-PRIM-TAPIJT-TRAP: ‚Ç¨' + oldPrice + ' ‚Üí ‚Ç¨' + newPrice);
            }
            
            if (newPrice != oldPrice) {
                pr.Eenheidsprijs__c = newPrice;
                toUpdate.add(pr);
            }
        }
        
        if (!toUpdate.isEmpty()) {
            update toUpdate;
            System.debug('‚úÖ Updated ' + toUpdate.size() + ' price records');
        } else {
            System.debug('‚ÑπÔ∏è All prices already correct');
        }
    }
}

System.debug('\nüéâ Price update complete!');
System.debug('üìã Summary:');
System.debug('  - SR-PRIM-TAPIJT-PLAT: ‚Ç¨18.50/m¬≤');
System.debug('  - SR-PRIM-TAPIJT-TRAP: ‚Ç¨8.50/trede');
